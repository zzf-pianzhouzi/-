{"ast":null,"code":"import request from \"@/utils/request\";\nexport default {\n  name: \"Message\",\n\n  data() {\n    return {\n      user: {},\n      messages: [],\n      dialogFormVisible: false,\n      isCollapse: false,\n      entity: {}\n    };\n  },\n\n  created() {\n    this.user = sessionStorage.getItem(\"user\") ? JSON.parse(sessionStorage.getItem(\"user\")) : {};\n    this.loadMessage();\n  },\n\n  methods: {\n    loadMessage() {\n      // 如果是留言的话，就写死=0\n      // 如果是 评论，则需要设置 当前被评论的模块的id作为foreignId\n      let foreignId = 0;\n      request.get(\"/message/foreign/\" + foreignId).then(res => {\n        this.messages = res.data;\n      });\n    },\n\n    cancel() {\n      this.dialogFormVisible = false;\n      this.entity = {};\n    },\n\n    reReply(id) {\n      this.dialogFormVisible = true;\n      this.entity.parentId = id;\n    },\n\n    reply() {\n      this.entity.content = this.entity.reply;\n      this.save();\n    },\n\n    save() {\n      if (!this.user.username) {\n        this.$message({\n          message: \"请登录\",\n          type: \"warning\"\n        });\n        return;\n      }\n\n      if (!this.entity.content) {\n        this.$message({\n          message: \"请填写内容\",\n          type: \"warning\"\n        });\n        return;\n      } // 如果是评论的话，在 save的时候要注意设置 当前模块的id为 foreignId。也就是  entity.foreignId = 模块id\n\n\n      request.post(\"/message\", this.entity).then(res => {\n        if (res.code === '0') {\n          this.$message({\n            message: \"评论成功\",\n            type: \"success\"\n          });\n        } else {\n          this.$message({\n            message: res.msg,\n            type: \"error\"\n          });\n        }\n\n        this.entity = {};\n        this.loadMessage();\n        this.dialogFormVisible = false;\n      });\n    },\n\n    del(id) {\n      request.delete(\"/message/\" + id).then(res => {\n        this.$message({\n          message: \"删除成功\",\n          type: \"success\"\n        });\n        this.loadMessage();\n      });\n    }\n\n  }\n};","map":{"version":3,"mappings":"AA8CA,OAAOA,OAAP,MAAoB,iBAApB;AAEA,eAAe;EACbC,IAAI,EAAE,SADO;;EAEbC,IAAI,GAAG;IACL,OAAO;MACLC,IAAI,EAAE,EADD;MAELC,QAAQ,EAAE,EAFL;MAGLC,iBAAiB,EAAE,KAHd;MAILC,UAAU,EAAE,KAJP;MAKLC,MAAM,EAAE;IALH,CAAP;EAOD,CAVY;;EAWbC,OAAO,GAAG;IACR,KAAKL,IAAL,GAAYM,cAAc,CAACC,OAAf,CAAuB,MAAvB,IAAiCC,IAAI,CAACC,KAAL,CAAWH,cAAc,CAACC,OAAf,CAAuB,MAAvB,CAAX,CAAjC,GAA8E,EAA1F;IACA,KAAKG,WAAL;EAGD,CAhBY;;EAiBbC,OAAO,EAAE;IACPD,WAAW,GAAG;MACZ;MACA;MACA,IAAIE,SAAQ,GAAI,CAAhB;MACAf,OAAO,CAACgB,GAAR,CAAY,sBAAsBD,SAAlC,EAA6CE,IAA7C,CAAkDC,GAAE,IAAK;QACvD,KAAKd,QAAL,GAAgBc,GAAG,CAAChB,IAApB;MACD,CAFD;IAGD,CARM;;IASPiB,MAAM,GAAG;MACP,KAAKd,iBAAL,GAAyB,KAAzB;MACA,KAAKE,MAAL,GAAc,EAAd;IACD,CAZM;;IAaPa,OAAO,CAACC,EAAD,EAAK;MACV,KAAKhB,iBAAL,GAAyB,IAAzB;MACA,KAAKE,MAAL,CAAYe,QAAZ,GAAuBD,EAAvB;IACD,CAhBM;;IAiBPE,KAAK,GAAG;MACN,KAAKhB,MAAL,CAAYiB,OAAZ,GAAsB,KAAKjB,MAAL,CAAYgB,KAAlC;MACA,KAAKE,IAAL;IACD,CApBM;;IAsBPA,IAAI,GAAG;MACL,IAAI,CAAC,KAAKtB,IAAL,CAAUuB,QAAf,EAAyB;QACvB,KAAKC,QAAL,CAAc;UACZC,OAAO,EAAE,KADG;UAEZC,IAAI,EAAE;QAFM,CAAd;QAIA;MACF;;MACA,IAAI,CAAC,KAAKtB,MAAL,CAAYiB,OAAjB,EAA0B;QACxB,KAAKG,QAAL,CAAc;UACZC,OAAO,EAAE,OADG;UAEZC,IAAI,EAAE;QAFM,CAAd;QAIA;MACF,CAdK,CAeL;;;MACA7B,OAAO,CAAC8B,IAAR,CAAa,UAAb,EAAyB,KAAKvB,MAA9B,EAAsCU,IAAtC,CAA2CC,GAAE,IAAK;QAChD,IAAIA,GAAG,CAACa,IAAJ,KAAa,GAAjB,EAAsB;UACpB,KAAKJ,QAAL,CAAc;YACZC,OAAO,EAAE,MADG;YAEZC,IAAI,EAAE;UAFM,CAAd;QAIF,CALA,MAKO;UACL,KAAKF,QAAL,CAAc;YACZC,OAAO,EAAEV,GAAG,CAACc,GADD;YAEZH,IAAI,EAAE;UAFM,CAAd;QAIF;;QACA,KAAKtB,MAAL,GAAc,EAAd;QACA,KAAKM,WAAL;QACA,KAAKR,iBAAL,GAAyB,KAAzB;MACD,CAfD;IAgBD,CAtDM;;IAuDP4B,GAAG,CAACZ,EAAD,EAAK;MACNrB,OAAO,CAACkC,MAAR,CAAe,cAAcb,EAA7B,EAAiCJ,IAAjC,CAAsCC,GAAE,IAAK;QAC3C,KAAKS,QAAL,CAAc;UACZC,OAAO,EAAE,MADG;UAEZC,IAAI,EAAE;QAFM,CAAd;QAIA,KAAKhB,WAAL;MACD,CAND;IAOF;;EA/DO;AAjBI,CAAf","names":["request","name","data","user","messages","dialogFormVisible","isCollapse","entity","created","sessionStorage","getItem","JSON","parse","loadMessage","methods","foreignId","get","then","res","cancel","reReply","id","parentId","reply","content","save","username","$message","message","type","post","code","msg","del","delete"],"sourceRoot":"","sources":["D:\\Desktop\\springboot+vue\\springboot-vue-demo\\src\\views\\Message.vue"],"sourcesContent":["<template>\n  <div style=\"margin-top: 10px; margin-bottom: 80px\">\n    <el-card>\n      <div style=\"padding: 20px; color: #888\">\n        <div>\n          <el-input type=\"textarea\" :rows=\"3\" v-model=\"entity.content\"></el-input>\n          <div style=\"text-align: right; padding: 10px\"><el-button type=\"primary\" @click=\"save\">留言</el-button></div>\n        </div>\n      </div>\n\n      <div style=\"display: flex; padding: 20px\" v-for=\"item in messages\">\n        <div style=\"text-align: center; flex: 1\">\n          <el-image :src=\"item.avatar\" style=\"width: 60px; height: 60px; border-radius: 50%\"></el-image>\n        </div>\n        <div style=\"padding: 0 10px; flex: 5\">\n          <div><b style=\"font-size: 14px\">{{ item.username }}</b></div>\n          <div style=\"padding: 10px 0; color: #888\">\n            {{ item.content }}\n            <el-button type=\"text\" size=\"mini\" @click=\"del(item.id)\" v-if=\"item.username === user.username\">删除</el-button>\n          </div>\n          <div style=\"background-color: #eee; padding: 10px\" v-if=\"item.parentMessage\">{{ item.username }}：{{ item.parentMessage.content }}</div>\n          <div style=\"color: #888; font-size: 12px\">\n            <span>{{ item.time  }}</span>\n            <el-button type=\"text\" style=\"margin-left: 20px\" @click=\"reReply(item.id)\">回复</el-button>\n          </div>\n        </div>\n      </div>\n\n      <el-dialog title=\"回复信息\" v-model=\"dialogFormVisible\" width=\"30%\">\n        <el-form :model=\"entity\" label-width=\"80px\">\n          <el-form-item label=\"内容\">\n            <el-input v-model=\"entity.reply\" autocomplete=\"off\" type=\"textarea\" :rows=\"3\"></el-input>\n          </el-form-item>\n        </el-form>\n        <template #footer>\n          <el-button @click=\"cancel\">取 消</el-button>\n          <el-button type=\"primary\" @click=\"reply\">确 定</el-button>\n        </template>\n      </el-dialog>\n    </el-card>\n\n\n  </div>\n</template>\n\n<script>\nimport request from \"@/utils/request\";\n\nexport default {\n  name: \"Message\",\n  data() {\n    return {\n      user: {},\n      messages: [],\n      dialogFormVisible: false,\n      isCollapse: false,\n      entity: {}\n    }\n  },\n  created() {\n    this.user = sessionStorage.getItem(\"user\") ? JSON.parse(sessionStorage.getItem(\"user\")) : {};\n    this.loadMessage();\n\n\n  },\n  methods: {\n    loadMessage() {\n      // 如果是留言的话，就写死=0\n      // 如果是 评论，则需要设置 当前被评论的模块的id作为foreignId\n      let foreignId = 0;\n      request.get(\"/message/foreign/\" + foreignId).then(res => {\n        this.messages = res.data;\n      })\n    },\n    cancel() {\n      this.dialogFormVisible = false;\n      this.entity = {};\n    },\n    reReply(id) {\n      this.dialogFormVisible = true;\n      this.entity.parentId = id;\n    },\n    reply() {\n      this.entity.content = this.entity.reply;\n      this.save();\n    },\n\n    save() {\n      if (!this.user.username) {\n        this.$message({\n          message: \"请登录\",\n          type: \"warning\"\n        });\n        return;\n      }\n      if (!this.entity.content) {\n        this.$message({\n          message: \"请填写内容\",\n          type: \"warning\"\n        });\n        return;\n      }\n      // 如果是评论的话，在 save的时候要注意设置 当前模块的id为 foreignId。也就是  entity.foreignId = 模块id\n      request.post(\"/message\", this.entity).then(res => {\n        if (res.code === '0') {\n          this.$message({\n            message: \"评论成功\",\n            type: \"success\"\n          });\n        } else {\n          this.$message({\n            message: res.msg,\n            type: \"error\"\n          });\n        }\n        this.entity = {}\n        this.loadMessage();\n        this.dialogFormVisible = false;\n      })\n    },\n    del(id) {\n      request.delete(\"/message/\" + id).then(res => {\n        this.$message({\n          message: \"删除成功\",\n          type: \"success\"\n        });\n        this.loadMessage()\n      })\n    }\n  }\n}\n</script>\n"]},"metadata":{},"sourceType":"module"}